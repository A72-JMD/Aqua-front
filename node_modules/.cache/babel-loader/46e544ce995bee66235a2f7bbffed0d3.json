{"ast":null,"code":"var _jsxFileName = \"/Users/JMD/Developments/Projects/Aqua/Aqua-front/src/views/BackofficeArea/RequestPositionsFiles.js\";\nimport React, { useState, useEffect, Component } from \"react\";\nimport { Auth, API } from \"aws-amplify\";\nimport Helpers from \"../../Common/helpers.js\";\nfunction LoadPositionsFiles(props) {\n  const [apiError502, setApiError502] = useState(false);\n  const [positions, setPositions] = useState([]);\n  const [Authheader, setHeader] = useState();\n  const getheader = async () => {\n    var result = \"Bearer \".concat((await Auth.currentSession() //Call aws-aplyfy Auth method\n    ).getIdToken().getJwtToken());\n    setHeader(result); // set the auth header here;\n    return result;\n  };\n  async function handleSubmit(file) {\n    Helpers.httpRequest(\"https://ww8jinvodc.execute-api.ap-southeast-2.amazonaws.com/V1/fiji-web-files/Banks%2FLGT%2FPositions%2F\" + file, \"get\", Authheader)\n    // 1. Convert the data into 'blob'\n    .then(response => response.blob()).then(blob => {\n      // 2. Create blob link to download\n      const url = window.URL.createObjectURL(new Blob([blob]));\n      const link = document.createElement(\"a\");\n      link.href = url;\n      link.setAttribute(\"download\", file);\n      // 3. Append to html page\n      document.body.appendChild(link);\n      // 4. Force download\n      link.click();\n      // 5. Clean up and remove the link\n      link.parentNode.removeChild(link);\n\n      //.then((response) => {\n    });\n\n    // prevent form submit\n    //event.preventDefault();\n  }\n  useEffect(() => {\n    //Load Auth header\n    getheader();\n    // Pull out into a generic reusable function\n    var HeaderAuth = \"test\";\n    const getData = async fileType => {\n      try {\n        let apiName = \"Fiji-Dev\";\n        let path = \"/listfiles\";\n        let myInit = {\n          headers: {\n            'Access-Control-Allow-Origin': '*',\n            filetype: fileType,\n            Authorization: \"Bearer \".concat((await Auth.currentSession()).getIdToken().getJwtToken())\n          }\n        };\n        console.log(\"==========INIT with token==============\");\n        Array.isArray(myInit.headers);\n        HeaderAuth = myInit.headers.Authorization;\n        console.log(\"========================\");\n        var result = await API.get(apiName, path, myInit);\n        console.log(result);\n        setPositions(result); // set your files here;\n      } catch (e) {\n        if (e.message === \"Request failed with status code 502\") {\n          setApiError502(true);\n        } else {\n          alert(JSON.stringify(e));\n          props.onLogout();\n        }\n      }\n    };\n    // call getData\n    getData(\"Positions\");\n    console.log(HeaderAuth);\n  }, []);\n  return /*#__PURE__*/React.createElement(\"div\", {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 88,\n      columnNumber: 5\n    }\n  }, Array.isArray(positions.Files) && positions.Files.map(filetype => {\n    return /*#__PURE__*/React.createElement(\"div\", {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 93,\n        columnNumber: 13\n      }\n    }, filetype.Positions.map(function (file) {\n      return /*#__PURE__*/React.createElement(\"div\", {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 96,\n          columnNumber: 19\n        }\n      }, /*#__PURE__*/React.createElement(\"div\", {\n        class: \"d-none d-sm-inline-block col-sm-6\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 97,\n          columnNumber: 21\n        }\n      }, /*#__PURE__*/React.createElement(\"button\", {\n        onClick: () => handleSubmit(file.File),\n        class: \"float-right btn btn-primary\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 98,\n          columnNumber: 23\n        }\n      }, /*#__PURE__*/React.createElement(\"i\", {\n        class: \"icon-cloud-download\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 102,\n          columnNumber: 25\n        }\n      })), /*#__PURE__*/React.createElement(\"div\", {\n        \"aria-label\": \"Toolbar with button groups\",\n        role: \"toolbar\",\n        class: \"float-right btn-toolbar\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 104,\n          columnNumber: 23\n        }\n      }, /*#__PURE__*/React.createElement(\"div\", {\n        \"aria-label\": \"First group\",\n        role: \"group\",\n        class: \"mr-3 btn-group\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 109,\n          columnNumber: 25\n        }\n      }, /*#__PURE__*/React.createElement(\"button\", {\n        type: \"button\",\n        class: \"btn btn-outline-secondary active\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 114,\n          columnNumber: 27\n        }\n      }, file.Bank), /*#__PURE__*/React.createElement(\"button\", {\n        type: \"button\",\n        class: \"btn btn-outline-secondary\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 120,\n          columnNumber: 27\n        }\n      }, file.File), /*#__PURE__*/React.createElement(\"button\", {\n        type: \"button\",\n        class: \"btn btn-outline-secondary\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 126,\n          columnNumber: 27\n        }\n      }, \"Status\")))));\n    }));\n  }));\n}\nexport default LoadPositionsFiles;","map":{"version":3,"names":["React","useState","useEffect","Component","Auth","API","Helpers","LoadPositionsFiles","props","apiError502","setApiError502","positions","setPositions","Authheader","setHeader","getheader","result","concat","currentSession","getIdToken","getJwtToken","handleSubmit","file","httpRequest","then","response","blob","url","window","URL","createObjectURL","Blob","link","document","createElement","href","setAttribute","body","appendChild","click","parentNode","removeChild","HeaderAuth","getData","fileType","apiName","path","myInit","headers","filetype","Authorization","console","log","Array","isArray","get","e","message","alert","JSON","stringify","onLogout","__self","__source","fileName","_jsxFileName","lineNumber","columnNumber","Files","map","Positions","class","onClick","File","role","type","Bank"],"sources":["/Users/JMD/Developments/Projects/Aqua/Aqua-front/src/views/BackofficeArea/RequestPositionsFiles.js"],"sourcesContent":["import React, { useState, useEffect, Component } from \"react\";\r\nimport { Auth, API } from \"aws-amplify\";\r\nimport Helpers from \"../../Common/helpers.js\";\r\n\r\n\r\nfunction LoadPositionsFiles(props) {\r\n  const [apiError502, setApiError502] = useState(false);\r\n  const [positions, setPositions] = useState([]);\r\n  const [Authheader, setHeader] = useState();\r\n\r\n  const getheader = async () => {\r\n    var result = `Bearer ${(await Auth.currentSession()) //Call aws-aplyfy Auth method\r\n      .getIdToken()\r\n      .getJwtToken()}`;\r\n    setHeader(result); // set the auth header here;\r\n    return result;\r\n  };\r\n  async function handleSubmit(file) {\r\n    Helpers.httpRequest(\r\n      `https://ww8jinvodc.execute-api.ap-southeast-2.amazonaws.com/V1/fiji-web-files/Banks%2FLGT%2FPositions%2F` +\r\n        file,\r\n      \"get\",\r\n      Authheader\r\n    )\r\n      // 1. Convert the data into 'blob'\r\n      .then((response) => response.blob())\r\n      .then((blob) => {\r\n        // 2. Create blob link to download\r\n        const url = window.URL.createObjectURL(new Blob([blob]));\r\n        const link = document.createElement(\"a\");\r\n        link.href = url;\r\n        link.setAttribute(\"download\", file);\r\n        // 3. Append to html page\r\n        document.body.appendChild(link);\r\n        // 4. Force download\r\n        link.click();\r\n        // 5. Clean up and remove the link\r\n        link.parentNode.removeChild(link);\r\n\r\n        //.then((response) => {\r\n      });\r\n\r\n    // prevent form submit\r\n    //event.preventDefault();\r\n  }\r\n\r\n  useEffect(() => {\r\n    //Load Auth header\r\n    getheader();\r\n    // Pull out into a generic reusable function\r\n    var HeaderAuth = \"test\";\r\n    const getData = async (fileType) => {\r\n      try {\r\n        let apiName = \"Fiji-Dev\";\r\n        let path = \"/listfiles\";\r\n        let myInit = {\r\n          headers: {\r\n            'Access-Control-Allow-Origin': '*',\r\n            filetype: fileType,\r\n            Authorization: `Bearer ${(await Auth.currentSession())\r\n              .getIdToken()\r\n              .getJwtToken()}`,\r\n          },\r\n        };\r\n        console.log(\"==========INIT with token==============\");\r\n        Array.isArray(myInit.headers);\r\n        HeaderAuth = myInit.headers.Authorization;\r\n        console.log(\"========================\");\r\n\r\n        var result = await API.get(apiName, path, myInit);\r\n        console.log(result);\r\n        setPositions(result); // set your files here;\r\n      } catch (e) {\r\n        if (e.message === \"Request failed with status code 502\") {\r\n          setApiError502(true);\r\n        } else {\r\n          alert(JSON.stringify(e));\r\n          props.onLogout();\r\n        }\r\n      }\r\n    };\r\n    // call getData\r\n    getData(\"Positions\");\r\n    console.log(HeaderAuth);\r\n  }, []);\r\n  \r\n  return (\r\n    <div>\r\n      \r\n      {Array.isArray(positions.Files) &&\r\n        positions.Files.map((filetype) => {\r\n          return (\r\n            <div>\r\n              {filetype.Positions.map(function (file) {\r\n                return (\r\n                  <div>\r\n                    <div class=\"d-none d-sm-inline-block col-sm-6\">\r\n                      <button\r\n                        onClick={() => handleSubmit(file.File)}\r\n                        class=\"float-right btn btn-primary\"\r\n                      >\r\n                        <i class=\"icon-cloud-download\"></i>\r\n                      </button>\r\n                      <div\r\n                        aria-label=\"Toolbar with button groups\"\r\n                        role=\"toolbar\"\r\n                        class=\"float-right btn-toolbar\"\r\n                      >\r\n                        <div\r\n                          aria-label=\"First group\"\r\n                          role=\"group\"\r\n                          class=\"mr-3 btn-group\"\r\n                        >\r\n                          <button\r\n                            type=\"button\"\r\n                            class=\"btn btn-outline-secondary active\"\r\n                          >\r\n                            {file.Bank}\r\n                          </button>\r\n                          <button\r\n                            type=\"button\"\r\n                            class=\"btn btn-outline-secondary\"\r\n                          >\r\n                            {file.File}\r\n                          </button>\r\n                          <button\r\n                            type=\"button\"\r\n                            class=\"btn btn-outline-secondary\"\r\n                          >\r\n                            Status\r\n                          </button>\r\n                        </div>\r\n                      </div>\r\n                    </div>\r\n                  </div>\r\n                );\r\n              })}\r\n            </div>\r\n          );\r\n        })}\r\n    </div>\r\n  );\r\n}\r\nexport default LoadPositionsFiles;\r\n"],"mappings":"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"},"metadata":{},"sourceType":"module"}