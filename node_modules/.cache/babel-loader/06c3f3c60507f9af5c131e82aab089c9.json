{"ast":null,"code":"var _jsxFileName = \"/Users/JMD/Developments/Projects/Aqua/Aqua-front/src/views/Pages/Register/Register.js\";\nimport React, { useState } from \"react\";\nimport { Alert, Card, CardBody, CardFooter, Col, Container, Form, Input, InputGroup, InputGroupAddon, InputGroupText, Row } from \"reactstrap\";\nimport LoaderButton from \"../../../components/LoaderButton/LoaderButton\";\nimport { useFormFields } from \"../../../hooks/useFormFields\";\nimport { Auth, API } from \"aws-amplify\";\nimport QRCode from \"qrcode.react\";\nimport \"./Register.scss\";\n// import { FileSystemCredentials } from \"aws-sdk/global\";\n\nexport default function Register(props) {\n  const [fields, handleFieldChange] = useFormFields({\n    email: \"\",\n    password: \"\",\n    confirmPassword: \"\",\n    confirmationCode: \"\",\n    mfaVerificationCode: \"\"\n  });\n  const [newUser, setNewUser] = useState(null);\n  const [userConfirmed, setUserConfirmed] = useState(false);\n  const [isLoading, setIsLoading] = useState(false);\n  const [qrLink, setQRLink] = useState(\"\");\n  const [mfaQrCode, setMFAQRCode] = useState(\"\");\n  const [mfaSession, setMFASession] = useState(\"\");\n  const [userGuid, setUserGuid] = useState(\"\"); //eslint-disable-line\n  const [mfaFailedAlertVisible, setMFAFailedAlertVisible] = useState(false); //eslint-disable-line\n\n  // TODO: Use this\n  // function validateForm() {\n  //   return (\n  //     fields.email.length > 0 &&\n  //     fields.password.length > 0 &&\n  //     fields.password === fields.confirmPassword\n  //   );\n  // }\n\n  // function validateConfirmationForm() {\n  //   return fields.confirmationCode.length > 0;\n  // }\n\n  async function handleSubmit(event) {\n    event.preventDefault();\n    setIsLoading(true);\n    try {\n      console.log(\"==========check email==============\");\n      console.log(fields.email);\n      const newUser = await Auth.signUp({\n        username: fields.email,\n        password: fields.password,\n        attributes: {\n          \"custom:Group\": \"Customer\" // custom attribute, not standard\n        }\n      });\n      console.log(\"==========check newuser==============\");\n      console.log(newUser);\n      setIsLoading(false);\n      setNewUser(newUser);\n    } catch (e) {\n      alert(e.message);\n      setIsLoading(false);\n    }\n  }\n\n  /// #1 send the user session to validate MFA,\n  /// returns: MFA secret, MFA Session\n  const validateMFA = async () => {\n    var x = await Auth.signIn(fields.email, fields.password);\n    setUserGuid(x.username);\n    var body = {\n      session: x.Session\n    };\n    try {\n      let apiName = \"Fiji-Dev\";\n      let path = \"/secretgenerator\";\n      let myInit = {\n        headers: {\n          \"Content-Type\": \"application/json\"\n        },\n        body\n      };\n      var result = await API.post(apiName, path, myInit);\n      console.log(result);\n    } catch (e) {\n      if (e.message === \"Request failed with status code 502\") {} else {\n        alert(JSON.stringify(e));\n      }\n    }\n    return result;\n  };\n\n  /// #2 Finalise MFA using the TOTP and Session from #1\n  /// Returns: MFA Session (unused)\n  const finaliseMFA = async totp => {\n    var body = {\n      session: mfaSession,\n      code: totp,\n      device: \"\"\n    };\n    try {\n      let apiName = \"Fiji-Dev\";\n      let path = \"/finalise-mfa\";\n      let myInit = {\n        headers: {\n          \"Content-Type\": \"application/json\"\n        },\n        body\n      };\n      var result = await API.post(apiName, path, myInit);\n    } catch (e) {\n      // TODO: Gracefully handle failed MFA\n      if (e.message === \"Request failed with status code 502\") {} else {\n        alert(JSON.stringify(e));\n      }\n    }\n    return result;\n  };\n\n  // Authenticate with the user creds and MFA.\n  // NOTE: Doesn't work as expected, MFA token gets expired on first use (verify)\n  // this means we cannot reuse it to automatically auth the user.\n  // const authWithMFA = async mses => {\n  //   try {\n  //     var mfaAuthSession = await Auth.signIn(fields.email, fields.password);\n\n  //     var body = {\n  //       session: mfaAuthSession.Session,\n  //       client_id: config.cognito.APP_CLIENT_ID,\n  //       username: userGuid,\n  //       code: fields.mfaVerificationCode\n  //     };\n\n  //     let apiName = \"Fiji-Dev\";\n  //     let path = \"/mfavalidator\";\n  //     let myInit = {\n  //       headers: {\n  //         \"Content-Type\": \"application/json\"\n  //       },\n  //       body\n  //     };\n  //     var result = await API.post(apiName, path, myInit);\n  //   } catch (e) {\n  //     if (e.message === \"Request failed with status code 502\") {\n  //     } else {\n  //       alert(JSON.stringify(e));\n  //     }\n  //   }\n  //   return result;\n  // };\n\n  async function handleConfirmationSubmit(event) {\n    event.preventDefault();\n    setIsLoading(true);\n    await Auth.confirmSignUp(fields.email, fields.confirmationCode).then(data => console.log(data));\n    try {\n      // Get secret from API\n      await validateMFA().then(data => {\n        setMFAQRCode(data.SecretCode);\n        setMFASession(data.Session);\n        setQRLink(\"otpauth://totp/Fiji:\" + fields.email + \"?secret=\" + data.SecretCode + \"&issuer=Fiji-issuer\");\n      }).catch(err => console.log(err));\n      setUserConfirmed(true);\n      setIsLoading(false);\n      //});\n    } catch (e) {\n      alert(e);\n      setIsLoading(false);\n    }\n  }\n  async function handleMFASubmit(event) {\n    try {\n      event.preventDefault();\n      setIsLoading(true);\n      await finaliseMFA(fields.mfaVerificationCode);\n      // .then(data => {\n      //  var newMFASession = \"\";\n      //   newMFASession = data.body.Session;\n      // });\n    } catch (e) {\n      alert(\"Waiting for Reece to fix the Lambda :)\");\n      alert(JSON.stringify(e.message));\n    }\n    // var x = newMFASession;\n    // var authw = authWithMFA(newMFASession);\n\n    // console.log(\"authw\");\n    // console.log(authw);\n\n    // TODO: make this a bit more graceful. provide user feedback (success alert)\n    props.history.push(\"/login\");\n    setIsLoading(false);\n  }\n\n  // function showMFAAlert() {\n  //   setMFAFailedAlertVisible(true);\n\n  //   setTimeout(() => {\n  //     setMFAFailedAlertVisible(false);\n  //   }, 5000);\n  // }\n\n  function renderQRCode() {\n    return /*#__PURE__*/React.createElement(\"div\", {\n      className: \"app flex-row align-items-center\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 242,\n        columnNumber: 7\n      }\n    }, /*#__PURE__*/React.createElement(Container, {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 243,\n        columnNumber: 9\n      }\n    }, /*#__PURE__*/React.createElement(Row, {\n      className: \"justify-content-center\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 244,\n        columnNumber: 11\n      }\n    }, /*#__PURE__*/React.createElement(Col, {\n      md: \"9\",\n      lg: \"7\",\n      xl: \"6\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 245,\n        columnNumber: 13\n      }\n    }, /*#__PURE__*/React.createElement(Card, {\n      className: \"mx-4\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 246,\n        columnNumber: 15\n      }\n    }, /*#__PURE__*/React.createElement(CardBody, {\n      className: \"p-4\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 247,\n        columnNumber: 17\n      }\n    }, /*#__PURE__*/React.createElement(Form, {\n      onSubmit: handleMFASubmit,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 248,\n        columnNumber: 19\n      }\n    }, /*#__PURE__*/React.createElement(\"h1\", {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 249,\n        columnNumber: 21\n      }\n    }, \"Enable MFA\"), /*#__PURE__*/React.createElement(\"p\", {\n      className: \"text-muted\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 250,\n        columnNumber: 21\n      }\n    }, \"Enter the code from your email to confirm.\"), /*#__PURE__*/React.createElement(QRCode, {\n      value: qrLink,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 254,\n        columnNumber: 21\n      }\n    }), /*#__PURE__*/React.createElement(\"p\", {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 255,\n        columnNumber: 21\n      }\n    }, \"Scan the code above in your Authenticator app of choice.\"), /*#__PURE__*/React.createElement(\"p\", {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 258,\n        columnNumber: 21\n      }\n    }, \"If you are unable to scan the image, enter the following information:\", /*#__PURE__*/React.createElement(\"br\", {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 261,\n        columnNumber: 23\n      }\n    }), \"code: \", mfaQrCode), /*#__PURE__*/React.createElement(\"p\", {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 264,\n        columnNumber: 21\n      }\n    }, \"Enter the value in the field below to verify the account.\"), /*#__PURE__*/React.createElement(InputGroup, {\n      className: \"mb-3\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 267,\n        columnNumber: 21\n      }\n    }, /*#__PURE__*/React.createElement(InputGroupAddon, {\n      addonType: \"prepend\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 268,\n        columnNumber: 23\n      }\n    }, /*#__PURE__*/React.createElement(InputGroupText, {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 269,\n        columnNumber: 25\n      }\n    }, \"#\")), /*#__PURE__*/React.createElement(Input, {\n      id: \"mfaVerificationCode\",\n      type: \"tel\",\n      placeholder: \"Verify MFA Code\",\n      onChange: handleFieldChange,\n      autoFocus: true,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 271,\n        columnNumber: 23\n      }\n    })), /*#__PURE__*/React.createElement(LoaderButton, {\n      color: \"success\",\n      block: true,\n      isLoading: isLoading,\n      disabled: isLoading,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 279,\n        columnNumber: 21\n      }\n    }, \"Verify Code\"), /*#__PURE__*/React.createElement(\"p\", {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 287,\n        columnNumber: 21\n      }\n    }, /*#__PURE__*/React.createElement(Alert, {\n      color: \"danger\",\n      className: mfaFailedAlertVisible ? \"alert-shown\" : \"alert-hidden\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 288,\n        columnNumber: 23\n      }\n    }, \"Failed to verify MFA code.\")))), /*#__PURE__*/React.createElement(CardFooter, {\n      className: \"p-4\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 299,\n        columnNumber: 17\n      }\n    }))))));\n  }\n  function renderConfirmationForm() {\n    return /*#__PURE__*/React.createElement(\"div\", {\n      className: \"app flex-row align-items-center\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 310,\n        columnNumber: 7\n      }\n    }, /*#__PURE__*/React.createElement(Container, {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 311,\n        columnNumber: 9\n      }\n    }, /*#__PURE__*/React.createElement(Row, {\n      className: \"justify-content-center\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 312,\n        columnNumber: 11\n      }\n    }, /*#__PURE__*/React.createElement(Col, {\n      md: \"9\",\n      lg: \"7\",\n      xl: \"6\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 313,\n        columnNumber: 13\n      }\n    }, /*#__PURE__*/React.createElement(Card, {\n      className: \"mx-4\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 314,\n        columnNumber: 15\n      }\n    }, /*#__PURE__*/React.createElement(CardBody, {\n      className: \"p-4\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 315,\n        columnNumber: 17\n      }\n    }, /*#__PURE__*/React.createElement(Form, {\n      onSubmit: handleConfirmationSubmit,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 316,\n        columnNumber: 19\n      }\n    }, /*#__PURE__*/React.createElement(\"h1\", {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 317,\n        columnNumber: 21\n      }\n    }, \"Confirmation code\"), /*#__PURE__*/React.createElement(\"p\", {\n      className: \"text-muted\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 318,\n        columnNumber: 21\n      }\n    }, \"Enter the code from your email to confirm.\"), /*#__PURE__*/React.createElement(InputGroup, {\n      className: \"mb-3\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 321,\n        columnNumber: 21\n      }\n    }, /*#__PURE__*/React.createElement(InputGroupAddon, {\n      addonType: \"prepend\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 322,\n        columnNumber: 23\n      }\n    }, /*#__PURE__*/React.createElement(InputGroupText, {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 323,\n        columnNumber: 25\n      }\n    }, \"#\")), /*#__PURE__*/React.createElement(Input, {\n      id: \"confirmationCode\",\n      type: \"tel\",\n      placeholder: \"Confirmation Code\",\n      onChange: handleFieldChange,\n      autoFocus: true,\n      value: fields.confirmationCode,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 325,\n        columnNumber: 23\n      }\n    })), /*#__PURE__*/React.createElement(LoaderButton, {\n      color: \"success\",\n      block: true,\n      isLoading: isLoading,\n      disabled: isLoading,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 334,\n        columnNumber: 21\n      }\n    }, \" \", \"Create Account\"))), /*#__PURE__*/React.createElement(CardFooter, {\n      className: \"p-4\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 345,\n        columnNumber: 17\n      }\n    }))))));\n  }\n  function renderForm() {\n    return /*#__PURE__*/React.createElement(\"div\", {\n      className: \"app flex-row align-items-center\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 356,\n        columnNumber: 7\n      }\n    }, /*#__PURE__*/React.createElement(Container, {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 357,\n        columnNumber: 9\n      }\n    }, /*#__PURE__*/React.createElement(Row, {\n      className: \"justify-content-center\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 358,\n        columnNumber: 11\n      }\n    }, /*#__PURE__*/React.createElement(Col, {\n      md: \"9\",\n      lg: \"7\",\n      xl: \"6\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 359,\n        columnNumber: 13\n      }\n    }, /*#__PURE__*/React.createElement(Card, {\n      className: \"mx-4\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 360,\n        columnNumber: 15\n      }\n    }, /*#__PURE__*/React.createElement(CardBody, {\n      className: \"p-4\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 361,\n        columnNumber: 17\n      }\n    }, /*#__PURE__*/React.createElement(Form, {\n      onSubmit: handleSubmit,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 362,\n        columnNumber: 19\n      }\n    }, /*#__PURE__*/React.createElement(\"h1\", {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 363,\n        columnNumber: 21\n      }\n    }, \"Register\"), /*#__PURE__*/React.createElement(\"p\", {\n      className: \"text-muted\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 364,\n        columnNumber: 21\n      }\n    }, \"Create your account\"), /*#__PURE__*/React.createElement(InputGroup, {\n      className: \"mb-3\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 365,\n        columnNumber: 21\n      }\n    }, /*#__PURE__*/React.createElement(InputGroupAddon, {\n      addonType: \"prepend\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 366,\n        columnNumber: 23\n      }\n    }, /*#__PURE__*/React.createElement(InputGroupText, {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 367,\n        columnNumber: 25\n      }\n    }, \"@\")), /*#__PURE__*/React.createElement(Input, {\n      id: \"email\",\n      type: \"text\",\n      placeholder: \"Email\",\n      autoComplete: \"email\",\n      onChange: handleFieldChange,\n      value: fields.email,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 369,\n        columnNumber: 23\n      }\n    })), /*#__PURE__*/React.createElement(InputGroup, {\n      className: \"mb-3\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 378,\n        columnNumber: 21\n      }\n    }, /*#__PURE__*/React.createElement(InputGroupAddon, {\n      addonType: \"prepend\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 379,\n        columnNumber: 23\n      }\n    }, /*#__PURE__*/React.createElement(InputGroupText, {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 380,\n        columnNumber: 25\n      }\n    }, /*#__PURE__*/React.createElement(\"i\", {\n      className: \"icon-lock\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 381,\n        columnNumber: 27\n      }\n    }))), /*#__PURE__*/React.createElement(Input, {\n      id: \"password\",\n      type: \"password\",\n      placeholder: \"Password\",\n      autoComplete: \"new-password\",\n      onChange: handleFieldChange,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 384,\n        columnNumber: 23\n      }\n    })), /*#__PURE__*/React.createElement(InputGroup, {\n      className: \"mb-4\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 392,\n        columnNumber: 21\n      }\n    }, /*#__PURE__*/React.createElement(InputGroupAddon, {\n      addonType: \"prepend\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 393,\n        columnNumber: 23\n      }\n    }, /*#__PURE__*/React.createElement(InputGroupText, {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 394,\n        columnNumber: 25\n      }\n    }, /*#__PURE__*/React.createElement(\"i\", {\n      className: \"icon-lock\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 395,\n        columnNumber: 27\n      }\n    }))), /*#__PURE__*/React.createElement(Input, {\n      id: \"confirmPassword\",\n      type: \"password\",\n      placeholder: \"Confirm password\",\n      autoComplete: \"new-password\",\n      onChange: handleFieldChange,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 398,\n        columnNumber: 23\n      }\n    })), /*#__PURE__*/React.createElement(LoaderButton, {\n      color: \"success\",\n      block: true,\n      isLoading: isLoading,\n      disabled: isLoading,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 406,\n        columnNumber: 21\n      }\n    }, \" \", \"Create Account\"))), /*#__PURE__*/React.createElement(CardFooter, {\n      className: \"p-4\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 417,\n        columnNumber: 17\n      }\n    }))))));\n  }\n  return /*#__PURE__*/React.createElement(\"div\", {\n    className: \"Register\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 440,\n      columnNumber: 5\n    }\n  }, newUser === null ? renderForm() : userConfirmed === false ? renderConfirmationForm() : renderQRCode());\n}","map":{"version":3,"names":["React","useState","Alert","Card","CardBody","CardFooter","Col","Container","Form","Input","InputGroup","InputGroupAddon","InputGroupText","Row","LoaderButton","useFormFields","Auth","API","QRCode","Register","props","fields","handleFieldChange","email","password","confirmPassword","confirmationCode","mfaVerificationCode","newUser","setNewUser","userConfirmed","setUserConfirmed","isLoading","setIsLoading","qrLink","setQRLink","mfaQrCode","setMFAQRCode","mfaSession","setMFASession","userGuid","setUserGuid","mfaFailedAlertVisible","setMFAFailedAlertVisible","handleSubmit","event","preventDefault","console","log","signUp","username","attributes","e","alert","message","validateMFA","x","signIn","body","session","Session","apiName","path","myInit","headers","result","post","JSON","stringify","finaliseMFA","totp","code","device","handleConfirmationSubmit","confirmSignUp","then","data","SecretCode","catch","err","handleMFASubmit","history","push","renderQRCode","createElement","className","__self","__source","fileName","_jsxFileName","lineNumber","columnNumber","md","lg","xl","onSubmit","value","addonType","id","type","placeholder","onChange","autoFocus","color","block","disabled","renderConfirmationForm","renderForm","autoComplete"],"sources":["/Users/JMD/Developments/Projects/Aqua/Aqua-front/src/views/Pages/Register/Register.js"],"sourcesContent":["import React, { useState } from \"react\";\r\nimport {\r\n  Alert,\r\n  Card,\r\n  CardBody,\r\n  CardFooter,\r\n  Col,\r\n  Container,\r\n  Form,\r\n  Input,\r\n  InputGroup,\r\n  InputGroupAddon,\r\n  InputGroupText,\r\n  Row,\r\n} from \"reactstrap\";\r\n\r\nimport LoaderButton from \"../../../components/LoaderButton/LoaderButton\";\r\nimport { useFormFields } from \"../../../hooks/useFormFields\";\r\n\r\nimport { Auth, API } from \"aws-amplify\";\r\n\r\nimport QRCode from \"qrcode.react\";\r\n\r\nimport \"./Register.scss\";\r\n// import { FileSystemCredentials } from \"aws-sdk/global\";\r\n\r\nexport default function Register(props) {\r\n  const [fields, handleFieldChange] = useFormFields({\r\n    email: \"\",\r\n    password: \"\",\r\n    confirmPassword: \"\",\r\n    confirmationCode: \"\",\r\n    mfaVerificationCode: \"\",\r\n  });\r\n  const [newUser, setNewUser] = useState(null);\r\n  const [userConfirmed, setUserConfirmed] = useState(false);\r\n  const [isLoading, setIsLoading] = useState(false);\r\n  const [qrLink, setQRLink] = useState(\"\");\r\n  const [mfaQrCode, setMFAQRCode] = useState(\"\");\r\n  const [mfaSession, setMFASession] = useState(\"\");\r\n  const [userGuid, setUserGuid] = useState(\"\"); //eslint-disable-line\r\n  const [mfaFailedAlertVisible, setMFAFailedAlertVisible] = useState(false); //eslint-disable-line\r\n\r\n  // TODO: Use this\r\n  // function validateForm() {\r\n  //   return (\r\n  //     fields.email.length > 0 &&\r\n  //     fields.password.length > 0 &&\r\n  //     fields.password === fields.confirmPassword\r\n  //   );\r\n  // }\r\n\r\n  // function validateConfirmationForm() {\r\n  //   return fields.confirmationCode.length > 0;\r\n  // }\r\n\r\n  async function handleSubmit(event) {\r\n    event.preventDefault();\r\n\r\n    setIsLoading(true);\r\n\r\n    try {\r\n      console.log(\"==========check email==============\");\r\n      console.log(fields.email);\r\n      const newUser = await Auth.signUp({\r\n        username: fields.email,\r\n        password: fields.password,\r\n        attributes: {\r\n          \"custom:Group\": \"Customer\", // custom attribute, not standard\r\n        },\r\n      });\r\n      console.log(\"==========check newuser==============\");\r\n      console.log(newUser);\r\n      setIsLoading(false);\r\n      setNewUser(newUser);\r\n    } catch (e) {\r\n      alert(e.message);\r\n      setIsLoading(false);\r\n    }\r\n  }\r\n\r\n  /// #1 send the user session to validate MFA,\r\n  /// returns: MFA secret, MFA Session\r\n  const validateMFA = async () => {\r\n    var x = await Auth.signIn(fields.email, fields.password);\r\n    setUserGuid(x.username);\r\n    var body = {\r\n      session: x.Session,\r\n    };\r\n\r\n    try {\r\n      let apiName = \"Fiji-Dev\";\r\n      let path = \"/secretgenerator\";\r\n      let myInit = {\r\n        headers: {\r\n          \"Content-Type\": \"application/json\",\r\n        },\r\n        body,\r\n      };\r\n      var result = await API.post(apiName, path, myInit);\r\n      console.log(result);\r\n    } catch (e) {\r\n      if (e.message === \"Request failed with status code 502\") {\r\n      } else {\r\n        alert(JSON.stringify(e));\r\n      }\r\n    }\r\n    return result;\r\n  };\r\n\r\n  /// #2 Finalise MFA using the TOTP and Session from #1\r\n  /// Returns: MFA Session (unused)\r\n  const finaliseMFA = async (totp) => {\r\n    var body = {\r\n      session: mfaSession,\r\n      code: totp,\r\n      device: \"\",\r\n    };\r\n\r\n    try {\r\n      let apiName = \"Fiji-Dev\";\r\n      let path = \"/finalise-mfa\";\r\n      let myInit = {\r\n        headers: {\r\n          \"Content-Type\": \"application/json\",\r\n        },\r\n        body,\r\n      };\r\n      var result = await API.post(apiName, path, myInit);\r\n    } catch (e) {\r\n      // TODO: Gracefully handle failed MFA\r\n      if (e.message === \"Request failed with status code 502\") {\r\n      } else {\r\n        alert(JSON.stringify(e));\r\n      }\r\n    }\r\n    return result;\r\n  };\r\n\r\n  // Authenticate with the user creds and MFA.\r\n  // NOTE: Doesn't work as expected, MFA token gets expired on first use (verify)\r\n  // this means we cannot reuse it to automatically auth the user.\r\n  // const authWithMFA = async mses => {\r\n  //   try {\r\n  //     var mfaAuthSession = await Auth.signIn(fields.email, fields.password);\r\n\r\n  //     var body = {\r\n  //       session: mfaAuthSession.Session,\r\n  //       client_id: config.cognito.APP_CLIENT_ID,\r\n  //       username: userGuid,\r\n  //       code: fields.mfaVerificationCode\r\n  //     };\r\n\r\n  //     let apiName = \"Fiji-Dev\";\r\n  //     let path = \"/mfavalidator\";\r\n  //     let myInit = {\r\n  //       headers: {\r\n  //         \"Content-Type\": \"application/json\"\r\n  //       },\r\n  //       body\r\n  //     };\r\n  //     var result = await API.post(apiName, path, myInit);\r\n  //   } catch (e) {\r\n  //     if (e.message === \"Request failed with status code 502\") {\r\n  //     } else {\r\n  //       alert(JSON.stringify(e));\r\n  //     }\r\n  //   }\r\n  //   return result;\r\n  // };\r\n\r\n  async function handleConfirmationSubmit(event) {\r\n    event.preventDefault();\r\n    setIsLoading(true);\r\n\r\n    await Auth.confirmSignUp(\r\n      fields.email,\r\n      fields.confirmationCode\r\n    ).then((data) => console.log(data));\r\n\r\n    try {\r\n      // Get secret from API\r\n      await validateMFA()\r\n        .then((data) => {\r\n          setMFAQRCode(data.SecretCode);\r\n\r\n          setMFASession(data.Session);\r\n\r\n          setQRLink(\r\n            \"otpauth://totp/Fiji:\" +\r\n              fields.email +\r\n              \"?secret=\" +\r\n              data.SecretCode +\r\n              \"&issuer=Fiji-issuer\"\r\n          );\r\n        })\r\n        .catch((err) => console.log(err));\r\n      setUserConfirmed(true);\r\n      setIsLoading(false);\r\n      //});\r\n    } catch (e) {\r\n      alert(e);\r\n      setIsLoading(false);\r\n    }\r\n  }\r\n\r\n  async function handleMFASubmit(event) {\r\n    try {\r\n      event.preventDefault();\r\n      setIsLoading(true);\r\n      await finaliseMFA(fields.mfaVerificationCode);\r\n      // .then(data => {\r\n      //  var newMFASession = \"\";\r\n      //   newMFASession = data.body.Session;\r\n      // });\r\n    } catch (e) {\r\n      alert(\"Waiting for Reece to fix the Lambda :)\");\r\n      alert(JSON.stringify(e.message));\r\n    }\r\n    // var x = newMFASession;\r\n    // var authw = authWithMFA(newMFASession);\r\n\r\n    // console.log(\"authw\");\r\n    // console.log(authw);\r\n\r\n    // TODO: make this a bit more graceful. provide user feedback (success alert)\r\n    props.history.push(\"/login\");\r\n\r\n    setIsLoading(false);\r\n  }\r\n\r\n  // function showMFAAlert() {\r\n  //   setMFAFailedAlertVisible(true);\r\n\r\n  //   setTimeout(() => {\r\n  //     setMFAFailedAlertVisible(false);\r\n  //   }, 5000);\r\n  // }\r\n\r\n  function renderQRCode() {\r\n    return (\r\n      <div className=\"app flex-row align-items-center\">\r\n        <Container>\r\n          <Row className=\"justify-content-center\">\r\n            <Col md=\"9\" lg=\"7\" xl=\"6\">\r\n              <Card className=\"mx-4\">\r\n                <CardBody className=\"p-4\">\r\n                  <Form onSubmit={handleMFASubmit}>\r\n                    <h1>Enable MFA</h1>\r\n                    <p className=\"text-muted\">\r\n                      Enter the code from your email to confirm.\r\n                    </p>\r\n\r\n                    <QRCode value={qrLink} />\r\n                    <p>\r\n                      Scan the code above in your Authenticator app of choice.\r\n                    </p>\r\n                    <p>\r\n                      If you are unable to scan the image, enter the following\r\n                      information:\r\n                      <br />\r\n                      code: {mfaQrCode}\r\n                    </p>\r\n                    <p>\r\n                      Enter the value in the field below to verify the account.\r\n                    </p>\r\n                    <InputGroup className=\"mb-3\">\r\n                      <InputGroupAddon addonType=\"prepend\">\r\n                        <InputGroupText>#</InputGroupText>\r\n                      </InputGroupAddon>\r\n                      <Input\r\n                        id=\"mfaVerificationCode\"\r\n                        type=\"tel\"\r\n                        placeholder=\"Verify MFA Code\"\r\n                        onChange={handleFieldChange}\r\n                        autoFocus\r\n                      />\r\n                    </InputGroup>\r\n                    <LoaderButton\r\n                      color=\"success\"\r\n                      block\r\n                      isLoading={isLoading}\r\n                      disabled={isLoading}\r\n                    >\r\n                      Verify Code\r\n                    </LoaderButton>\r\n                    <p>\r\n                      <Alert\r\n                        color=\"danger\"\r\n                        className={\r\n                          mfaFailedAlertVisible ? \"alert-shown\" : \"alert-hidden\"\r\n                        }\r\n                      >\r\n                        Failed to verify MFA code.\r\n                      </Alert>\r\n                    </p>\r\n                  </Form>\r\n                </CardBody>\r\n                <CardFooter className=\"p-4\"></CardFooter>\r\n              </Card>\r\n            </Col>\r\n          </Row>\r\n        </Container>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  function renderConfirmationForm() {\r\n    return (\r\n      <div className=\"app flex-row align-items-center\">\r\n        <Container>\r\n          <Row className=\"justify-content-center\">\r\n            <Col md=\"9\" lg=\"7\" xl=\"6\">\r\n              <Card className=\"mx-4\">\r\n                <CardBody className=\"p-4\">\r\n                  <Form onSubmit={handleConfirmationSubmit}>\r\n                    <h1>Confirmation code</h1>\r\n                    <p className=\"text-muted\">\r\n                      Enter the code from your email to confirm.\r\n                    </p>\r\n                    <InputGroup className=\"mb-3\">\r\n                      <InputGroupAddon addonType=\"prepend\">\r\n                        <InputGroupText>#</InputGroupText>\r\n                      </InputGroupAddon>\r\n                      <Input\r\n                        id=\"confirmationCode\"\r\n                        type=\"tel\"\r\n                        placeholder=\"Confirmation Code\"\r\n                        onChange={handleFieldChange}\r\n                        autoFocus\r\n                        value={fields.confirmationCode}\r\n                      />\r\n                    </InputGroup>\r\n                    <LoaderButton\r\n                      color=\"success\"\r\n                      block\r\n                      isLoading={isLoading}\r\n                      disabled={isLoading}\r\n                    >\r\n                      {\" \"}\r\n                      Create Account\r\n                    </LoaderButton>\r\n                  </Form>\r\n                </CardBody>\r\n                <CardFooter className=\"p-4\"></CardFooter>\r\n              </Card>\r\n            </Col>\r\n          </Row>\r\n        </Container>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  function renderForm() {\r\n    return (\r\n      <div className=\"app flex-row align-items-center\">\r\n        <Container>\r\n          <Row className=\"justify-content-center\">\r\n            <Col md=\"9\" lg=\"7\" xl=\"6\">\r\n              <Card className=\"mx-4\">\r\n                <CardBody className=\"p-4\">\r\n                  <Form onSubmit={handleSubmit}>\r\n                    <h1>Register</h1>\r\n                    <p className=\"text-muted\">Create your account</p>\r\n                    <InputGroup className=\"mb-3\">\r\n                      <InputGroupAddon addonType=\"prepend\">\r\n                        <InputGroupText>@</InputGroupText>\r\n                      </InputGroupAddon>\r\n                      <Input\r\n                        id=\"email\"\r\n                        type=\"text\"\r\n                        placeholder=\"Email\"\r\n                        autoComplete=\"email\"\r\n                        onChange={handleFieldChange}\r\n                        value={fields.email}\r\n                      />\r\n                    </InputGroup>\r\n                    <InputGroup className=\"mb-3\">\r\n                      <InputGroupAddon addonType=\"prepend\">\r\n                        <InputGroupText>\r\n                          <i className=\"icon-lock\"></i>\r\n                        </InputGroupText>\r\n                      </InputGroupAddon>\r\n                      <Input\r\n                        id=\"password\"\r\n                        type=\"password\"\r\n                        placeholder=\"Password\"\r\n                        autoComplete=\"new-password\"\r\n                        onChange={handleFieldChange}\r\n                      />\r\n                    </InputGroup>\r\n                    <InputGroup className=\"mb-4\">\r\n                      <InputGroupAddon addonType=\"prepend\">\r\n                        <InputGroupText>\r\n                          <i className=\"icon-lock\"></i>\r\n                        </InputGroupText>\r\n                      </InputGroupAddon>\r\n                      <Input\r\n                        id=\"confirmPassword\"\r\n                        type=\"password\"\r\n                        placeholder=\"Confirm password\"\r\n                        autoComplete=\"new-password\"\r\n                        onChange={handleFieldChange}\r\n                      />\r\n                    </InputGroup>\r\n                    <LoaderButton\r\n                      color=\"success\"\r\n                      block\r\n                      isLoading={isLoading}\r\n                      disabled={isLoading}\r\n                    >\r\n                      {\" \"}\r\n                      Create Account\r\n                    </LoaderButton>\r\n                  </Form>\r\n                </CardBody>\r\n                <CardFooter className=\"p-4\">\r\n                  {/* <Row>\r\n                    <Col xs=\"12\" sm=\"6\">\r\n                      <Button className=\"btn-facebook mb-1\" block>\r\n                        <span>facebook</span>\r\n                      </Button>\r\n                    </Col>\r\n                    <Col xs=\"12\" sm=\"6\">\r\n                      <Button className=\"btn-twitter mb-1\" block>\r\n                        <span>twitter</span>\r\n                      </Button>\r\n                    </Col>\r\n                  </Row> */}\r\n                </CardFooter>\r\n              </Card>\r\n            </Col>\r\n          </Row>\r\n        </Container>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  return (\r\n    <div className=\"Register\">\r\n      {newUser === null\r\n        ? renderForm()\r\n        : userConfirmed === false\r\n        ? renderConfirmationForm()\r\n        : renderQRCode()}\r\n    </div>\r\n  );\r\n}\r\n"],"mappings":"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"},"metadata":{},"sourceType":"module"}