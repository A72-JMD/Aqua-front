{"ast":null,"code":"var _jsxFileName = \"/Users/JMD/Developments/Projects/Fiji-Web/src/views/BackofficeArea/VendorAssessmentForm.js\";\nimport React, { useState, useEffect } from \"react\";\nimport { Auth, API } from \"aws-amplify\";\nimport DynamicForm from \"../../components/DynamicForm/DynamicForm\";\nimport { Row } from \"reactstrap\";\nimport LoadingBlock from \"../../components/loadingBlock/loadingBlock\";\nfunction VendorAssessmentForm(props, location) {\n  const [formTitle, setFormTitle] = useState(\"Vendor Assessment\"); //eslint-disable-line\n  const [formModel, setForm] = useState([]);\n  const [isLoading, setIsLoading] = useState(false);\n  const [pageReady, setPageReady] = useState(false);\n  const [maxPages, setMaxPages] = useState(1);\n  useEffect(() => {\n    onLoad();\n  }, []); // eslint-disable-line\n\n  const onLoad = async () => {\n    setPageReady(false);\n    if (!props.currentAssessment) {\n      props.history.push(\"/vendor/dashboard\");\n    }\n    setFormTitle(\"\".concat(props.currentAssessmentCustomer));\n\n    // console.log(\"props.match.params.id\");\n    //let params = new URLSearchParams(location.search);\n    // console.log(params.get(\"vendor\"));\n    var currentUser = await Auth.currentAuthenticatedUser();\n    // console.log(\"currentUser\");\n    // console.log(currentUser);\n    var groups = await currentUser.signInUserSession.accessToken.payload[\"cognito:groups\"];\n\n    // console.log(\"groups\");\n    // console.log(groups);\n\n    // Only vendors are allowed here\n    if (groups.includes(\"Vendor\")) {} else {\n      props.history.push(\"/401\");\n    }\n    await getData().then(data => {\n      // console.log(\"data\");\n      // console.log(data);\n      var friendlyFields = data.body.friendly_questions;\n      // console.log(\"friendlyFields\");\n      // console.log(friendlyFields);\n\n      setForm(friendlyFields);\n      figureOutPagination(friendlyFields);\n      setIsLoading(false);\n      setPageReady(true);\n    }).catch(error => {\n      console.error(error);\n    });\n  };\n\n  // Pull out into a generic reusable function\n  const getData = async () => {\n    try {\n      let apiName = \"Fiji-Dev\";\n      let path = \"/assessments/\".concat(props.currentAssessment);\n      let myInit = {\n        headers: {\n          Authorization: \"Bearer \".concat((await Auth.currentSession()).getIdToken().getJwtToken())\n        }\n      };\n      var result = await API.get(apiName, path, myInit);\n      // console.log(\"result\");\n      // console.log(result);\n    } catch (e) {\n      if (e.message === \"Request failed with status code 502\") {\n        //toggleApiError502(true);\n      } else {\n        console.log(e);\n        //props.onLogout();\n      }\n    }\n    return result;\n  };\n  const putData = async body => {\n    setIsLoading(true);\n    try {\n      delete body.isLoading;\n      let apiName = \"Fiji-Dev\";\n      let path = \"/assessments/\".concat(props.currentAssessment);\n      let myInit = {\n        headers: {\n          Authorization: \"Bearer \".concat((await Auth.currentSession()).getIdToken().getJwtToken())\n        },\n        body\n      };\n      var result = await API.put(apiName, path, myInit);\n      // console.log(\"result\");\n      // console.log(result);\n    } catch (e) {\n      if (e.message === \"Request failed with status code 502\") {\n        //toggleApiError502(true);\n      } else {\n        console.log(e);\n        //props.onLogout();\n      }\n      setIsLoading(false);\n    }\n    setIsLoading(false);\n    return result;\n  };\n  const handleSubmit = async model => {\n    console.log(\"submittedHere\");\n    console.log(model);\n    putData(model);\n  };\n  const figureOutPagination = async model => {\n    try {\n      let categories = [...new Set(model.map(m => m.category))]; // Distinct list of the question categories\n      // console.log(\"categories\");\n      // console.log(categories.length);\n      setMaxPages(categories.length);\n    } catch (e) {}\n  };\n  return /*#__PURE__*/React.createElement(\"div\", {\n    className: \"animated fadeIn\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 138,\n      columnNumber: 5\n    }\n  }, pageReady ? /*#__PURE__*/React.createElement(Row, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 140,\n      columnNumber: 9\n    }\n  }, /*#__PURE__*/React.createElement(DynamicForm, {\n    className: \"form\"\n    //title={formTitle}\n    ,\n    model: formModel,\n    onSubmit: model => {\n      handleSubmit(model);\n    },\n    isLoading: isLoading,\n    cancelButton: props.backClick,\n    cancelButtonText: \"Go back\",\n    visiblePage: 0,\n    maxPages: maxPages,\n    pagination: true,\n    assessmentId: props.currentAssessment,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 141,\n      columnNumber: 11\n    }\n  })) : /*#__PURE__*/React.createElement(LoadingBlock, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 158,\n      columnNumber: 9\n    }\n  }));\n}\nexport default VendorAssessmentForm;","map":{"version":3,"names":["React","useState","useEffect","Auth","API","DynamicForm","Row","LoadingBlock","VendorAssessmentForm","props","location","formTitle","setFormTitle","formModel","setForm","isLoading","setIsLoading","pageReady","setPageReady","maxPages","setMaxPages","onLoad","currentAssessment","history","push","concat","currentAssessmentCustomer","currentUser","currentAuthenticatedUser","groups","signInUserSession","accessToken","payload","includes","getData","then","data","friendlyFields","body","friendly_questions","figureOutPagination","catch","error","console","apiName","path","myInit","headers","Authorization","currentSession","getIdToken","getJwtToken","result","get","e","message","log","putData","put","handleSubmit","model","categories","Set","map","m","category","length","createElement","className","__self","__source","fileName","_jsxFileName","lineNumber","columnNumber","onSubmit","cancelButton","backClick","cancelButtonText","visiblePage","pagination","assessmentId"],"sources":["/Users/JMD/Developments/Projects/Fiji-Web/src/views/BackofficeArea/VendorAssessmentForm.js"],"sourcesContent":["import React, { useState, useEffect } from \"react\";\r\nimport { Auth, API } from \"aws-amplify\";\r\nimport DynamicForm from \"../../components/DynamicForm/DynamicForm\";\r\nimport { Row } from \"reactstrap\";\r\nimport LoadingBlock from \"../../components/loadingBlock/loadingBlock\";\r\n\r\nfunction VendorAssessmentForm(props, location) {\r\n  const [formTitle, setFormTitle] = useState(\"Vendor Assessment\"); //eslint-disable-line\r\n  const [formModel, setForm] = useState([]);\r\n  const [isLoading, setIsLoading] = useState(false);\r\n  const [pageReady, setPageReady] = useState(false);\r\n  const [maxPages, setMaxPages] = useState(1);\r\n\r\n  useEffect(() => {\r\n    onLoad();\r\n  }, []); // eslint-disable-line\r\n\r\n  const onLoad = async () => {\r\n    setPageReady(false);\r\n\r\n    if (!props.currentAssessment) {\r\n      props.history.push(\"/vendor/dashboard\");\r\n    }\r\n\r\n    setFormTitle(`${props.currentAssessmentCustomer}`);\r\n\r\n    // console.log(\"props.match.params.id\");\r\n    //let params = new URLSearchParams(location.search);\r\n    // console.log(params.get(\"vendor\"));\r\n    var currentUser = await Auth.currentAuthenticatedUser();\r\n    // console.log(\"currentUser\");\r\n    // console.log(currentUser);\r\n    var groups = await currentUser.signInUserSession.accessToken.payload[\r\n      \"cognito:groups\"\r\n    ];\r\n\r\n    // console.log(\"groups\");\r\n    // console.log(groups);\r\n\r\n    // Only vendors are allowed here\r\n    if (groups.includes(\"Vendor\")) {\r\n    } else {\r\n      props.history.push(\"/401\");\r\n    }\r\n\r\n    await getData()\r\n      .then(data => {\r\n        // console.log(\"data\");\r\n        // console.log(data);\r\n        var friendlyFields = data.body.friendly_questions;\r\n        // console.log(\"friendlyFields\");\r\n        // console.log(friendlyFields);\r\n\r\n        setForm(friendlyFields);\r\n        figureOutPagination(friendlyFields);\r\n        setIsLoading(false);\r\n        setPageReady(true);\r\n      })\r\n      .catch(error => {\r\n        console.error(error);\r\n      });\r\n  };\r\n\r\n  // Pull out into a generic reusable function\r\n  const getData = async () => {\r\n    try {\r\n      let apiName = \"Fiji-Dev\";\r\n      let path = `/assessments/${props.currentAssessment}`;\r\n      let myInit = {\r\n        headers: {\r\n          Authorization: `Bearer ${(await Auth.currentSession())\r\n            .getIdToken()\r\n            .getJwtToken()}`\r\n        }\r\n      };\r\n      var result = await API.get(apiName, path, myInit);\r\n      // console.log(\"result\");\r\n      // console.log(result);\r\n    } catch (e) {\r\n      if (e.message === \"Request failed with status code 502\") {\r\n        //toggleApiError502(true);\r\n      } else {\r\n        console.log(e);\r\n        //props.onLogout();\r\n      }\r\n    }\r\n    return result;\r\n  };\r\n  const putData = async body => {\r\n    setIsLoading(true);\r\n\r\n    try {\r\n      delete body.isLoading;\r\n      let apiName = \"Fiji-Dev\";\r\n      let path = `/assessments/${props.currentAssessment}`;\r\n      let myInit = {\r\n        headers: {\r\n          Authorization: `Bearer ${(await Auth.currentSession())\r\n            .getIdToken()\r\n            .getJwtToken()}`\r\n        },\r\n        body\r\n      };\r\n      var result = await API.put(apiName, path, myInit);\r\n      // console.log(\"result\");\r\n      // console.log(result);\r\n    } catch (e) {\r\n      if (e.message === \"Request failed with status code 502\") {\r\n        //toggleApiError502(true);\r\n      } else {\r\n        console.log(e);\r\n        //props.onLogout();\r\n      }\r\n      setIsLoading(false);\r\n    }\r\n    setIsLoading(false);\r\n\r\n    return result;\r\n  };\r\n\r\n  const handleSubmit = async model => {\r\n    console.log(\"submittedHere\");\r\n    console.log(model);\r\n\r\n    putData(model);\r\n  };\r\n\r\n  const figureOutPagination = async model => {\r\n    try {\r\n      let categories = [...new Set(model.map(m => m.category))]; // Distinct list of the question categories\r\n      // console.log(\"categories\");\r\n      // console.log(categories.length);\r\n      setMaxPages(categories.length);\r\n    } catch (e) {}\r\n  };\r\n\r\n  return (\r\n    <div className=\"animated fadeIn\">\r\n      {pageReady ? (\r\n        <Row>\r\n          <DynamicForm\r\n            className=\"form\"\r\n            //title={formTitle}\r\n            model={formModel}\r\n            onSubmit={model => {\r\n              handleSubmit(model);\r\n            }}\r\n            isLoading={isLoading}\r\n            cancelButton={props.backClick}\r\n            cancelButtonText=\"Go back\"\r\n            visiblePage={0}\r\n            maxPages={maxPages}\r\n            pagination={true}\r\n            assessmentId={props.currentAssessment}\r\n          />\r\n        </Row>\r\n      ) : (\r\n        <LoadingBlock />\r\n      )}\r\n    </div>\r\n  );\r\n}\r\n\r\nexport default VendorAssessmentForm;\r\n"],"mappings":"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"},"metadata":{},"sourceType":"module"}